function updateDisplay() {
  let currentTimeMs = audioPlayer.currentTime * 1000;
  let newIndex = -1;
  for (let i = 0; i < ayahWords.length; i++) {
    if (ayahWords[i].scheduledTime <= currentTimeMs) {
      newIndex = i;
    } else {
      break;
    }
  }
  if (newIndex !== lastDisplayedIndex && newIndex >= 0) {
    lastDisplayedIndex = newIndex;
    const word = ayahWords[newIndex];

    if (window.innerWidth > window.innerHeight) {
      // Landscape: Show three words for both Arabic and English.
      
      // For Arabic (RTL): we want to show next, current, then previous.
      const prevWordAr = newIndex > 0 ? ayahWords[newIndex - 1] : null;
      let nextWordAr = newIndex < ayahWords.length - 1 ? ayahWords[newIndex + 1] : null;
      if (!nextWordAr && data[String(currentAyah + 1)] && data[String(currentAyah + 1)]["w"] && data[String(currentAyah + 1)]["w"].length > 0) {
        nextWordAr = data[String(currentAyah + 1)]["w"][0];
      }
      let arabicHTML = "";
      if (nextWordAr) {
        arabicHTML += `<span style="color:#999;">${nextWordAr.c}</span> `;
      }
      arabicHTML += `<span style="color:#000;font-weight:bold;">${word.c}</span> `;
      if (prevWordAr) {
        arabicHTML += `<span style="color:#999;">${prevWordAr.c}</span>`;
      }
      arabicText.innerHTML = arabicHTML;
      
      // For English: build the HTML in the same order as Arabic so that each translation
      // lines up with the Arabic word above it.
      const prevWordEng = newIndex > 0 ? ayahWords[newIndex - 1] : null;
      let nextWordEng = newIndex < ayahWords.length - 1 ? ayahWords[newIndex + 1] : null;
      if (!nextWordEng && data[String(currentAyah + 1)] && data[String(currentAyah + 1)]["w"] && data[String(currentAyah + 1)]["w"].length > 0) {
        nextWordEng = data[String(currentAyah + 1)]["w"][0];
      }
      let englishHTML = "";
      if (nextWordEng) {
        englishHTML += `<span style="color:#999;">${nextWordEng.e}</span> `;
      }
      englishHTML += `<span style="color:#000;font-weight:bold;">${word.e}</span> `;
      if (prevWordEng) {
        englishHTML += `<span style="color:#999;">${prevWordEng.e}</span>`;
      }
      englishText.innerHTML = englishHTML;
    } else {
      // Portrait/narrow screens: just show the current word.
      arabicText.innerHTML = word.c;
      englishText.innerHTML = word.e;
    }
    
    let surahStr = ("000" + surah).slice(-3);
    let ayahStr = ("000" + currentAyah).slice(-3);
    let wordIndexStr = ("000" + (newIndex + 1)).slice(-3);
    indexDisplay.textContent = `Index: ${surahStr}:${ayahStr}:${wordIndexStr}`;
  }
  requestAnimationFrame(updateDisplay);
}
