<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Left-to-Right Constant Pace</title>
  <style>
    body {
      margin: 0; padding: 0;
      font-family: sans-serif;
      background: #eef;
      overflow: hidden;
    }
    #controls {
      position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
      width: 100%; max-width: 800px;
      background: #fff; box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0.5em;
    }
    #container {
      position: relative;
      width: 100%; height: 100vh;
      overflow: hidden;
    }
    #fixedArabic {
      position: absolute;
      top: 25vh; left: 50%;
      transform: translateX(-50%);
      width: 90%; height: 20vh;
      pointer-events: none;
    }
    #arabicText {
      position: relative;
      /* We remove direction:rtl here so offsetWidth is standard.
         If you need Arabic shaping, you can keep direction:rtl *inside each word*, but not on the container. */
    }
    #arabicLine {
      position: relative; /* each word is absolutely positioned inside here */
      height: 1em;
    }
    .arabic {
      position: absolute;
      font-size: 60px;
      color: #999;
      /* If you want correct Arabic shaping, you can do direction:rtl on each word: */
      direction: rtl; text-align: center;
    }
    .current { color: #000; font-weight: bold; }
  </style>
</head>
<body>
  <div id="container">
    <div id="fixedArabic">
      <div id="arabicText">
        <div id="arabicLine"></div>
      </div>
    </div>
    <div id="controls">
      <audio id="audioPlayer" controls></audio>
      <div id="indexDisplay"></div>
    </div>
  </div>
  <script>
    // Example data (words with times). In your case, you'll load from JSON.
    // If your first word has b=0.2, it won't be at center at t=0, but at t=0.2s instead.
    const ayahWords = [
      { b: 0.0, c: "بِسْمِ", e: "In the name of" },
      { b: 1.2, c: "اللَّهِ", e: "Allah" },
      { b: 2.3, c: "الرَّحْمَٰنِ", e: "the Most Gracious" },
      { b: 3.5, c: "الرَّحِيمِ", e: "the Most Merciful" }
    ];

    // Constant scroll speed: px per ms. If it's too small, it might overlap. Adjust as needed.
    const scrollSpeed = 0.1; // 0.1 = 100px/s

    // HTML elements
    const audioPlayer = document.getElementById("audioPlayer");
    const arabicLine  = document.getElementById("arabicLine");
    const indexDisplay= document.getElementById("indexDisplay");

    // Build line
    function buildLine() {
      arabicLine.innerHTML = "";
      ayahWords.forEach((w,i) => {
        // Create span
        const span = document.createElement("span");
        span.className = "arabic";
        span.textContent = w.c;
        // Store the scheduledTime in ms
        const sTime = w.b * 1000; // remove the "-0.1" offset
        span.dataset.scheduledTime = sTime;
        span.dataset.index = i;
        arabicLine.appendChild(span);
      });
      requestAnimationFrame(layoutWords);
    }

    // Place each word so that at time = scheduledTime,
    // the word's RIGHT edge is at screen center (screenCenter).
    // left = screenCenter - (scrollSpeed * sTime) - wordWidth
    function layoutWords() {
      const screenCenter = window.innerWidth / 2;
      Array.from(arabicLine.children).forEach(el => {
        const sTime = parseFloat(el.dataset.scheduledTime);
        const width = el.offsetWidth;
        const left = screenCenter - scrollSpeed * sTime - width;
        el.style.left = left + "px";
      });
    }

    // The main animation loop
    function updateDisplay() {
      const currentTimeMs = audioPlayer.currentTime * 1000;
      // shift line rightward
      const offset = scrollSpeed * currentTimeMs;
      arabicLine.style.transform = `translateX(${offset}px)`;

      // highlight current word
      let currentIndex = -1;
      for (let i=0; i<ayahWords.length; i++){
        if (currentTimeMs >= ayahWords[i].b * 1000){
          currentIndex = i;
        } else break;
      }
      Array.from(arabicLine.children).forEach(el => {
        const idx = parseInt(el.dataset.index);
        el.classList.toggle("current", idx === currentIndex);
      });

      // update display text
      indexDisplay.textContent = `Index: ${currentIndex + 1}`;
      requestAnimationFrame(updateDisplay);
    }

    // Example usage: load an MP3 and start
    audioPlayer.src = "example.mp3"; // or your actual audio file
    audioPlayer.oncanplaythrough = function(){
      buildLine();
      audioPlayer.play();
      requestAnimationFrame(updateDisplay);
    };
  </script>
</body>
</html>
